# Лабораторная работа №5
#### 
Имеется четыре виртуальные машины  :
* web1 
* web2
* haproxy1
* haproxy2

#### Что нужно сделать?

* Сервера web1 и web2 должны генерировать кастомную страницу, зайдя на которую было понятно, на каком сервере мы находимся
* Keepalived, для того, чтобы при отключении одного сервера другой не прекращал работу
* На серверах haproxy обеспечить балансировку нагрузки серверов web1 и web2 в режиме round-robin
* Написать playbook


------
#### Шпаргалка для запуска playbook

Сначала уничтожаем все то, что мы сделали:

````
vagrant destroy --force
````

Далее поднимаем vagrant:
````
vagrant up
````

И наконец, запускаем playbook, который все сделает за нас:

````
ansible-playbook haproxy.yml 
````

---
Проверяем балансировку:

# <a href="https://ibb.co/8x7PtKZ"><img src="https://i.ibb.co/M1CPQ20/2022-04-05-16-08-44.png" alt="2022-04-05-16-08-44" border="0"></a>


<a href="https://ibb.co/jTLzQS7"><img src="https://i.ibb.co/Y3tX1xv/2022-04-05-16-08-57.png" alt="2022-04-05-16-08-57" border="0"></a>

Как видим, по адресу 192.168.11.100 при обновлении страницы меняется сервер (web1 или web2), а это означает, что балансировка настроена правильно

---

Отключим один из haproxy, и убедимся в том, что отказоустойчивость работает

Сначала нужно убедится, на каком сейчас сервере находится наш сайт, с помощью следующей команды:
````
ip a
````
<a href="https://ibb.co/6myLNvN"><img src="https://i.ibb.co/ZVf7NHN/2022-04-05-17-06-43.png" alt="2022-04-05-17-06-43" border="0"></a>

Отключаем тот сервер, на котором он НЕ находится, следующей конмадой:
````
poweroff 
````

<a href="https://ibb.co/RHWGQ4X"><img src="https://i.ibb.co/mz7rhFn/2022-04-05-17-09-28.png" alt="2022-04-05-17-09-28" border="0"></a>

Сайт по прежнему работает что на первом, что на втором сервере, хотя один из них отключен, ну разве это не волшебство?

<a href="https://ibb.co/jTLzQS7"><img src="https://i.ibb.co/Y3tX1xv/2022-04-05-16-08-57.png" alt="2022-04-05-16-08-57" border="0"></a>



